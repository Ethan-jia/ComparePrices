<navigation-bar title="编辑商品" back="true" color="black" background="#FFF"></navigation-bar>
<view class="container" bindtap="onPageTap">
  <form class="form" catchtap="noop">
    <!-- 商品名称 - 使用下拉选择组件 -->
    <view class="form-group">
      <dropdown-select 
        label="商品名称"
        required="{{true}}"
        value="{{productName}}"
        placeholder="请输入商品名称"
        options="{{allProductNames}}"
        showDropdown="{{showProductNameDropdown}}"
        bindinput="onProductNameInput"
        bindfocus="onProductNameFocus"
        bindblur="onProductNameBlur"
        bindselect="onSelectProductName"
      ></dropdown-select>
    </view>
    <!-- 购买日期 -->
    <view class="form-group">
      <view class="form-label">购买日期 <text class="required">*</text></view>
      <picker 
        mode="date" 
        value="{{purchaseDate}}" 
        bindchange="onDateChange"
      >
        <view class="picker-input">
          <text class="picker-text">{{purchaseDate || '请选择日期'}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>
    <!-- 购买地点 - 使用下拉选择组件 -->
    <view class="form-group">
      <dropdown-select 
        label="购买地点"
        required="{{true}}"
        value="{{location}}"
        placeholder="请输入购买地点"
        options="{{allLocations}}"
        showDropdown="{{showLocationDropdown}}"
        bindinput="onLocationInput"
        bindfocus="onLocationFocus"
        bindblur="onLocationBlur"
        bindselect="onSelectLocation"
      ></dropdown-select>
    </view>

    <!-- 品牌 - 使用下拉选择组件 -->
    <view class="form-group">
      <dropdown-select 
        label="品牌"
        required="{{false}}"
        value="{{brand}}"
        placeholder="请输入品牌，如可口可乐、伊利等"
        options="{{allBrands}}"
        showDropdown="{{showBrandDropdown}}"
        bindinput="onBrandInput"
        bindfocus="onBrandFocus"
        bindblur="onBrandBlur"
        bindselect="onSelectBrand"
      ></dropdown-select>
    </view>
    <!-- 货币选择 -->
    <view class="form-group">
      <view class="form-label">货币 <text class="required">*</text></view>
      <picker 
        bindchange="onCurrencyChange" 
        value="{{currencyIndex}}" 
        range="{{currencies}}" 
        range-key="label"
      >
        <view class="picker-input">
          <text class="picker-text">{{currencies[currencyIndex].label}} ({{currencies[currencyIndex].symbol}})</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>

    <!-- 价格信息（并排对齐）- 使用价格输入组件 -->
    <view class="form-group" style="display: flex; gap: 12px;">
      <view style="flex:1;">
        <price-input
          label="现价"
          required="{{true}}"
          currencySymbol="{{currencies[currencyIndex].symbol}}"
          placeholder="0.00"
          value="{{currentPrice}}"
          bindinput="onCurrentPriceInput"
        ></price-input>
      </view>
      <view style="flex:1;">
        <price-input
          label="原价"
          required="{{false}}"
          currencySymbol="{{currencies[currencyIndex].symbol}}"
          placeholder="0.00"
          value="{{originalPrice}}"
          bindinput="onOriginalPriceInput"
        ></price-input>
      </view>
    </view>
    <!-- 备注信息 -->
    <view class="form-group">
      <view class="form-label">备注 <text class="optional">(可选)</text></view>
      <textarea 
        class="form-textarea" 
        placeholder="添加备注信息..." 
        value="{{note}}"
        bindinput="onNoteInput"
        maxlength="200"
      ></textarea>
      <view class="textarea-counter">{{note.length}}/200</view>
    </view>
    <!-- 底部占位，确保内容不被固定按钮遮挡 -->
    <view class="form-footer-placeholder"></view>
  </form>
</view>

<!-- 固定在底部的操作按钮 -->
<view class="fixed-form-actions">
  <button class="btn btn-secondary" bindtap="clearForm">清空</button>
  <button class="btn btn-primary" bindtap="saveProduct">更新</button>
</view>
