<!--index.wxml-->
<view class="main-container">
  <navigation-bar title="多比比" back="{{false}}" color="black" background="#FFF"></navigation-bar>

  <view class="product-list">
    <view wx:if="{{filteredProducts.length === 0}}" class="empty-state">
      <view class="empty-icon">📦</view>
      <view class="empty-text">暂无商品记录</view>
      <view class="empty-hint">点击下方按钮添加第一个商品</view>
    </view>

    <!-- 置顶内容 -->
    <view class="pinned-container">
      <view 
        class="product-card-container"
        wx:for="{{filteredProducts}}" 
        wx:key="id"
        wx:if="{{item && item.isPinned}}"
      >
        <view 
          class="product-card {{item.swipingLeft ? 'swiping-left' : ''}}"
          data-index="{{index}}"
          bindtouchstart="onTouchStart"
          bindtouchmove="onTouchMove"
          bindtouchend="onTouchEnd"
          bindtap="goToDetail"
        >
          <view class="product-info">
            <view class="product-name">
              <text>{{item.name}}</text>
              <text class="pin-icon">📌</text>
            </view>
            <view class="product-meta">
              <text class="product-date">{{item.date}}</text>
              <text class="product-location">{{item.location}}</text>
            </view>
          </view>
          
          <view class="product-price">
            <view class="current-price">{{item.currency && item.currency.symbol || '¥'}}{{item.currentPrice}}</view>
          </view>
        </view>

        <view class="action-buttons">
          <view 
            class="pin-btn"
            data-index="{{index}}"
            catchtap="togglePin"
          >
            取消置顶
          </view>
          
          <view 
            class="delete-btn"
            data-index="{{index}}"
            catchtap="deleteProduct"
          >
            删除
          </view>
        </view>
      </view>
    </view>

    <!-- 非置顶内容 -->
    <view class="unpinned-container">
      <view 
        class="product-card-container"
        wx:for="{{filteredProducts}}" 
        wx:key="id"
        wx:if="{{item && !item.isPinned}}"
      >
        <view 
          class="product-card {{item.swipingLeft ? 'swiping-left' : ''}}"
          data-index="{{index}}"
          bindtouchstart="onTouchStart"
          bindtouchmove="onTouchMove"
          bindtouchend="onTouchEnd"
          bindtap="goToDetail"
        >
          <view class="product-info">
            <view class="product-name">
              <text>{{item.name}}</text>
            </view>
            <view class="product-meta">
              <text class="product-date">{{item.date}}</text>
              <text class="product-location">{{item.location}}</text>
            </view>
          </view>
          
          <view class="product-price">
            <view class="current-price">{{item.currency && item.currency.symbol || '¥'}}{{item.currentPrice}}</view>
          </view>
        </view>

        <view class="action-buttons">
          <view 
            class="pin-btn"
            data-index="{{index}}"
            catchtap="togglePin"
          >
            置顶
          </view>
          
          <view 
            class="delete-btn"
            data-index="{{index}}"
            catchtap="deleteProduct"
          >
            删除
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 筛选面板 -->
  <view class="filter-panel" wx:if="{{showFilter}}">
    <!-- 价格排序 -->
    <view class="filter-group">
      <view class="filter-title">价格排序</view>
      <view class="sort-options">
        <view class="sort-option {{sortBy === 'priceAsc' ? 'active' : ''}}" data-sort="priceAsc" bindtap="setSortOption">
          价格从低到高
        </view>
        <view class="sort-option {{sortBy === 'priceDesc' ? 'active' : ''}}" data-sort="priceDesc" bindtap="setSortOption">
          价格从高到低
        </view>
      </view>
    </view>
    
    <!-- 日期排序 -->
    <view class="filter-group">
      <view class="filter-title">日期排序</view>
      <view class="sort-options">
        <view class="sort-option {{sortBy === 'dateDesc' ? 'active' : ''}}" data-sort="dateDesc" bindtap="setSortOption">
          最新日期优先
        </view>
        <view class="sort-option {{sortBy === 'dateAsc' ? 'active' : ''}}" data-sort="dateAsc" bindtap="setSortOption">
          最早日期优先
        </view>
      </view>
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="搜索商品" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <view class="search-icon">🔍</view>
      <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="clearSearch">✕</view>
    </view>
    <view class="filter-btn" bindtap="toggleFilter">
      <text>筛选</text>
      <text class="filter-icon">▼</text>
    </view>
  </view>

  <!-- 悬浮添加按钮 -->
  <view class="fab" bindtap="goToAdd">
    <text class="fab-icon">+</text>
  </view>
</view>
