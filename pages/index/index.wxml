<!--index.wxml-->
<view class="main-container">
  <navigation-bar title="å¤šæ¯”æ¯”" back="{{false}}" color="black" background="#FFF"></navigation-bar>

  <view class="product-list">
    <view wx:if="{{filteredProducts.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“¦</view>
      <view class="empty-text">æš‚æ— å•†å“è®°å½•</view>
      <view class="empty-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªå•†å“</view>
    </view>

    <!-- ç½®é¡¶å†…å®¹ -->
    <view class="pinned-container">
      <view 
        class="product-card-container"
        wx:for="{{filteredProducts}}" 
        wx:key="id"
        wx:if="{{item && item.isPinned}}"
      >
        <view 
          class="product-card {{item.swipingLeft ? 'swiping-left' : ''}}"
          data-index="{{index}}"
          bindtouchstart="onTouchStart"
          bindtouchmove="onTouchMove"
          bindtouchend="onTouchEnd"
          bindtap="goToDetail"
        >
          <view class="product-info">
            <view class="product-name">
              <text>{{item.name}}</text>
              <text class="pin-icon">ğŸ“Œ</text>
            </view>
            <view class="product-meta">
              <text class="product-date">{{item.date}}</text>
              <text class="product-location">{{item.location}}</text>
            </view>
          </view>
          
          <view class="product-price">
            <view class="current-price">{{item.currency && item.currency.symbol || 'Â¥'}}{{item.currentPrice}}</view>
          </view>
        </view>

        <view class="action-buttons">
          <view 
            class="pin-btn"
            data-index="{{index}}"
            catchtap="togglePin"
          >
            å–æ¶ˆç½®é¡¶
          </view>
          
          <view 
            class="delete-btn"
            data-index="{{index}}"
            catchtap="deleteProduct"
          >
            åˆ é™¤
          </view>
        </view>
      </view>
    </view>

    <!-- éç½®é¡¶å†…å®¹ -->
    <view class="unpinned-container">
      <view 
        class="product-card-container"
        wx:for="{{filteredProducts}}" 
        wx:key="id"
        wx:if="{{item && !item.isPinned}}"
      >
        <view 
          class="product-card {{item.swipingLeft ? 'swiping-left' : ''}}"
          data-index="{{index}}"
          bindtouchstart="onTouchStart"
          bindtouchmove="onTouchMove"
          bindtouchend="onTouchEnd"
          bindtap="goToDetail"
        >
          <view class="product-info">
            <view class="product-name">
              <text>{{item.name}}</text>
            </view>
            <view class="product-meta">
              <text class="product-date">{{item.date}}</text>
              <text class="product-location">{{item.location}}</text>
            </view>
          </view>
          
          <view class="product-price">
            <view class="current-price">{{item.currency && item.currency.symbol || 'Â¥'}}{{item.currentPrice}}</view>
          </view>
        </view>

        <view class="action-buttons">
          <view 
            class="pin-btn"
            data-index="{{index}}"
            catchtap="togglePin"
          >
            ç½®é¡¶
          </view>
          
          <view 
            class="delete-btn"
            data-index="{{index}}"
            catchtap="deleteProduct"
          >
            åˆ é™¤
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilter}}">
    <!-- ä»·æ ¼æ’åº -->
    <view class="filter-group">
      <view class="filter-title">ä»·æ ¼æ’åº</view>
      <view class="sort-options">
        <view class="sort-option {{sortBy === 'priceAsc' ? 'active' : ''}}" data-sort="priceAsc" bindtap="setSortOption">
          ä»·æ ¼ä»ä½åˆ°é«˜
        </view>
        <view class="sort-option {{sortBy === 'priceDesc' ? 'active' : ''}}" data-sort="priceDesc" bindtap="setSortOption">
          ä»·æ ¼ä»é«˜åˆ°ä½
        </view>
      </view>
    </view>
    
    <!-- æ—¥æœŸæ’åº -->
    <view class="filter-group">
      <view class="filter-title">æ—¥æœŸæ’åº</view>
      <view class="sort-options">
        <view class="sort-option {{sortBy === 'dateDesc' ? 'active' : ''}}" data-sort="dateDesc" bindtap="setSortOption">
          æœ€æ–°æ—¥æœŸä¼˜å…ˆ
        </view>
        <view class="sort-option {{sortBy === 'dateAsc' ? 'active' : ''}}" data-sort="dateAsc" bindtap="setSortOption">
          æœ€æ—©æ—¥æœŸä¼˜å…ˆ
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢å•†å“" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <view class="search-icon">ğŸ”</view>
      <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="clearSearch">âœ•</view>
    </view>
    <view class="filter-btn" bindtap="toggleFilter">
      <text>ç­›é€‰</text>
      <text class="filter-icon">â–¼</text>
    </view>
  </view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="goToAdd">
    <text class="fab-icon">+</text>
  </view>
</view>
